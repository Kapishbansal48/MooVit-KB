<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>üöñ Cab Sharing ‚Äì MooVit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 1rem;
    }

    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      padding: 2rem;
      text-align: center;
    }

    .content-area {
      padding: 2rem;
    }

    #map {
      height: 450px;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
    }

    .fare-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      padding: 1.5rem;
      margin-top: 1rem;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .vehicle-card {
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 1rem;
      margin: 0.5rem 0;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .vehicle-card:hover {
      border-color: #007bff;
      box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
      transform: translateY(-2px);
    }

    .vehicle-card.selected {
      border-color: #007bff;
      background-color: rgba(0, 123, 255, 0.1);
      transform: translateY(-2px);
    }

    .feature-badge {
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      margin: 0.2rem;
      display: inline-block;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
    }

    .feature-badge:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }

    .feature-badge.active {
      background: linear-gradient(45deg, #28a745, #20c997);
      transform: scale(1.05);
    }

    .weather-widget {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .time-slot {
      padding: 0.5rem 1rem;
      margin: 0.2rem;
      border: 2px solid #e9ecef;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: white;
    }

    .time-slot:hover {
      border-color: #007bff;
      background-color: #f8f9fa;
      transform: translateY(-2px);
    }

    .time-slot.selected {
      border-color: #007bff;
      background-color: #007bff;
      color: white;
      transform: translateY(-2px);
    }

    .passenger-counter {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }

    .counter-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      background: #007bff;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .counter-btn:hover {
      background: #0056b3;
      transform: scale(1.1);
    }

    .counter-btn:active {
      transform: scale(0.95);
    }

    .split-fare-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 1rem;
      margin: 0.5rem 0;
      backdrop-filter: blur(5px);
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      color: white;
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      max-width: 300px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: linear-gradient(45deg, #28a745, #20c997);
    }

    .notification.error {
      background: linear-gradient(45deg, #dc3545, #fd7e14);
    }

    .notification.info {
      background: linear-gradient(45deg, #17a2b8, #6f42c1);
    }

    .form-floating>label {
      color: #6c757d;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
    }

    .btn-gradient {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      color: white;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    .btn-gradient:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 25px rgba(102, 126, 234, 0.4);
      color: white;
    }

    .btn-gradient:active {
      transform: translateY(-1px);
    }

    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .eta-info {
      background: rgba(40, 167, 69, 0.1);
      border-left: 4px solid #28a745;
      padding: 1rem;
      border-radius: 5px;
      margin: 1rem 0;
      backdrop-filter: blur(5px);
    }

    .carbon-info {
      background: rgba(40, 167, 69, 0.1);
      border-left: 4px solid #28a745;
      padding: 1rem;
      border-radius: 5px;
      margin: 1rem 0;
      text-align: center;
      backdrop-filter: blur(5px);
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    .booking-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 1.5rem;
      margin-top: 1rem;
      backdrop-filter: blur(5px);
    }

    .stats-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }

    .stats-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .driver-info {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 1rem;
      margin-top: 1rem;
      backdrop-filter: blur(5px);
    }

    .rating-stars {
      color: #ffc107;
      font-size: 1.2rem;
    }

    .btn-action {
      transition: all 0.3s ease;
      margin: 0.2rem;
    }

    .btn-action:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }

    .swap-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: #007bff;
      color: white;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .swap-btn:hover {
      background: #0056b3;
      transform: translateY(-50%) rotate(180deg);
    }

    .form-section {
      position: relative;
    }

    @media (max-width: 768px) {
      .main-container {
        margin: 0;
        border-radius: 0;
      }

      .header {
        padding: 1rem;
      }

      .content-area {
        padding: 1rem;
      }

      #map {
        height: 300px;
      }

      .time-slot {
        font-size: 0.8rem;
        padding: 0.3rem 0.8rem;
      }

      .notification {
        right: 10px;
        left: 10px;
        transform: translateY(-100px);
        max-width: none;
      }

      .notification.show {
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <header class="bg-primary text-white p-3 d-flex justify-content-between align-items-center">
    <h1 class="mb-0">üöñ Cab Sharing Planner</h1>
    <div>
      <button id="toggleMode" class="btn btn-light me-2">üåÉ Toggle Mode</button>
      <a href="..\main.html" class="btn btn-light">‚Üê Home</a>
    </div>

    <div class="content-area">
      <!-- Weather Widget -->
      <div class="weather-widget fade-in">
        <h6><i class="fas fa-cloud-sun"></i> Current Weather in Bhopal</h6>
        <div id="weatherInfo">
          <div class="loading-spinner"></div>
        </div>
      </div>

      <!-- Main Form -->
      <form id="cabForm" class="row g-3">
        <!-- Location Selection -->
        <div class="col-lg-4 form-section">
          <div class="form-floating">
            <select class="form-select" id="start" required>
              <option value="">Choose start location</option>
              <option value="Indore">Indore</option>
              <option value="Ujjain">Ujjain</option>
              <option value="Bhopal">Bhopal</option>
              <option value="Dewas">Dewas</option>
              <option value="Ratlam">Ratlam</option>
              <option value="Gwalior">Gwalior</option>
            </select>
            <label for="start"><i class="fas fa-map-marker-alt"></i> Start Location</label>
          </div>
        </div>

        <div class="col-lg-4 form-section">
          <div class="form-floating">
            <select class="form-select" id="intermediate" multiple>
              <option value="Indore">Indore</option>
              <option value="Ujjain">Ujjain</option>
              <option value="Bhopal">Bhopal</option>
              <option value="Dewas">Dewas</option>
              <option value="Ratlam">Ratlam</option>
              <option value="Gwalior">Gwalior</option>
            </select>
            <label for="intermediate"><i class="fas fa-route"></i> Intermediate Stops (Ctrl+Click to select
              multiple)</label>
          </div>
        </div>


        <div class="col-lg-4 form-section">
          <div class="form-floating">
            <select class="form-select" id="destination" required>
              <option value="">Choose destination</option>
              <option value="Indore">Indore</option>
              <option value="Ujjain">Ujjain</option>
              <option value="Bhopal">Bhopal</option>
              <option value="Dewas">Dewas</option>
              <option value="Ratlam">Ratlam</option>
              <option value="Gwalior">Gwalior</option>
            </select>
            <label for="destination"><i class="fas fa-flag-checkered"></i> Destination</label>
          </div>
          <button type="button" class="swap-btn" onclick="swapLocations()" title="Swap start and destination">
            <i class="fas fa-exchange-alt"></i>
          </button>
        </div>

        <!-- Date and Time Selection -->
        <div class="col-md-6">
          <div class="form-floating">
            <input type="date" class="form-control" id="travelDate" required />
            <label for="travelDate"><i class="fas fa-calendar"></i> Travel Date</label>
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label"><i class="fas fa-clock"></i> Preferred Time</label>
          <div class="d-flex flex-wrap">
            <button type="button" class="time-slot" data-time="06:00">6:00 AM</button>
            <button type="button" class="time-slot" data-time="09:00">9:00 AM</button>
            <button type="button" class="time-slot" data-time="12:00">12:00 PM</button>
            <button type="button" class="time-slot" data-time="15:00">3:00 PM</button>
            <button type="button" class="time-slot" data-time="18:00">6:00 PM</button>
            <button type="button" class="time-slot" data-time="21:00">9:00 PM</button>
          </div>
        </div>

        <!-- Passenger Counters -->
        <div class="col-md-6">
          <label class="form-label"><i class="fas fa-users"></i> Passengers (Start ‚Üí Intermediate/Destination)</label>
          <div class="passenger-counter">
            <button type="button" class="counter-btn" onclick="changePassengers('pax1', -1)">
              <i class="fas fa-minus"></i>
            </button>
            <span id="pax1Display" class="h5 mx-3">1</span>
            <button type="button" class="counter-btn" onclick="changePassengers('pax1', 1)">
              <i class="fas fa-plus"></i>
            </button>
          </div>
          <input type="hidden" id="paxStartToIntermediate" value="1" />
        </div>

        <div class="col-md-6">
          <label class="form-label"><i class="fas fa-users"></i> Passengers (Intermediate ‚Üí Destination)</label>
          <div class="passenger-counter">
            <button type="button" class="counter-btn" onclick="changePassengers('pax2', -1)">
              <i class="fas fa-minus"></i>
            </button>
            <span id="pax2Display" class="h5 mx-3">1</span>
            <button type="button" class="counter-btn" onclick="changePassengers('pax2', 1)">
              <i class="fas fa-plus"></i>
            </button>
          </div>
          <input type="hidden" id="paxIntermediateToDestination" value="1" />
        </div>

        <!-- Vehicle Selection -->
        <div class="col-12">
          <label class="form-label"><i class="fas fa-car"></i> Select Vehicle Type</label>
          <div class="row">
            <div class="col-lg-4 col-md-6">
              <div class="vehicle-card" data-vehicle="sedan">
                <div class="d-flex align-items-center">
                  <i class="fas fa-car fa-3x text-primary me-3"></i>
                  <div class="flex-grow-1">
                    <h6 class="mb-1">Sedan</h6>
                    <small class="text-muted">4 seats ‚Ä¢ ‚Çπ12/km ‚Ä¢ AC</small>
                    <div class="mt-1">
                      <span class="badge bg-primary">Comfortable</span>
                      <span class="badge bg-success">Fuel Efficient</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-4 col-md-6">
              <div class="vehicle-card" data-vehicle="suv">
                <div class="d-flex align-items-center">
                  <i class="fas fa-truck fa-3x text-success me-3"></i>
                  <div class="flex-grow-1">
                    <h6 class="mb-1">SUV</h6>
                    <small class="text-muted">7 seats ‚Ä¢ ‚Çπ15/km ‚Ä¢ AC + Space</small>
                    <div class="mt-1">
                      <span class="badge bg-success">Spacious</span>
                      <span class="badge bg-info">Family Friendly</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-4 col-md-6 mx-auto">
              <div class="vehicle-card" data-vehicle="luxury">
                <div class="d-flex align-items-center">
                  <i class="fas fa-gem fa-3x text-warning me-3"></i>
                  <div class="flex-grow-1">
                    <h6 class="mb-1">Luxury</h6>
                    <small class="text-muted">4 seats ‚Ä¢ ‚Çπ20/km ‚Ä¢ Premium</small>
                    <div class="mt-1">
                      <span class="badge bg-warning">Premium</span>
                      <span class="badge bg-dark">VIP Service</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Additional Features -->
        <div class="col-12">
          <label class="form-label"><i class="fas fa-plus-circle"></i> Additional Features</label>
          <div class="d-flex flex-wrap">
            <div class="feature-badge" data-feature="wifi" data-cost="50">
              <i class="fas fa-wifi"></i> WiFi (+‚Çπ50)
            </div>
            <div class="feature-badge" data-feature="music" data-cost="30">
              <i class="fas fa-music"></i> Premium Music (+‚Çπ30)
            </div>
            <div class="feature-badge" data-feature="refreshment" data-cost="100">
              <i class="fas fa-coffee"></i> Refreshments (+‚Çπ100)
            </div>
            <div class="feature-badge" data-feature="priority" data-cost="200">
              <i class="fas fa-star"></i> Priority Booking (+‚Çπ200)
            </div>
            <div class="feature-badge" data-feature="insurance" data-cost="75">
              <i class="fas fa-shield-alt"></i> Travel Insurance (+‚Çπ75)
            </div>
          </div>
        </div>

        <div class="col-12 text-center mt-4">
          <button type="submit" class="btn btn-gradient btn-lg px-5 py-3">
            <i class="fas fa-calculator me-2"></i> Calculate Fare & Show Route
          </button>
          <div class="mt-2">
            <small class="text-muted">Press Ctrl+Enter for quick calculation</small>
          </div>
        </div>
      </form>

      <!-- Map Container -->
      <div id="map"></div>

      <!-- ETA Information -->
      <div id="etaInfo" class="eta-info fade-in" style="display: none;">
        <h6><i class="fas fa-clock text-success"></i> Estimated Journey Information</h6>
        <div id="etaContent"></div>
      </div>

      <!-- Carbon Footprint -->
      <div id="carbonInfo" class="carbon-info fade-in" style="display: none;">
        <h6><i class="fas fa-leaf text-success"></i> Environmental Impact</h6>
        <div id="carbonContent"></div>
      </div>

      <!-- Fare Results -->
      <div id="fareCard" class="fare-card fade-in" style="display: none;">
        <h4><i class="fas fa-money-bill-wave"></i> Fare Breakdown & Split</h4>
        <div id="fareResult"></div>
        <div id="splitFareResult"></div>

        <!-- Driver Information -->
        <div class="driver-info">
          <h6><i class="fas fa-id-card"></i> Driver Information</h6>
          <div class="row align-items-center">
            <div class="col-md-3 text-center">
              <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center"
                style="width: 60px; height: 60px;">
                <i class="fas fa-user fa-2x text-primary"></i>
              </div>
            </div>
            <div class="col-md-9">
              <h6 class="mb-1">Rajesh Kumar</h6>
              <div class="rating-stars mb-1">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <small class="text-light ms-1">(4.8/5) ‚Ä¢ 500+ trips</small>
              </div>
              <p class="mb-1"><i class="fas fa-phone me-2"></i>+91 98765 43210</p>
              <p class="mb-1"><i class="fas fa-car me-2"></i><span id="selectedVehicleInfo">Sedan - MP 09 CD 5678</span>
              </p>
              <p class="mb-0"><i class="fas fa-certificate me-2"></i>Verified ‚Ä¢ 5 years experience</p>
            </div>
          </div>

          <div class="mt-3 text-center">
            <button class="btn btn-light btn-action me-2" onclick="contactDriver('call')">
              <i class="fas fa-phone me-1"></i> Call Driver
            </button>
            <button class="btn btn-light btn-action me-2" onclick="contactDriver('sms')">
              <i class="fas fa-sms me-1"></i> Send SMS
            </button>
            <button class="btn btn-light btn-action" onclick="contactDriver('whatsapp')">
              <i class="fab fa-whatsapp me-1"></i> WhatsApp
            </button>
          </div>
        </div>

        <!-- Booking Section -->
        <div class="booking-section">
          <h6><i class="fas fa-check-circle"></i> Ready to Book Your Ride?</h6>
          <div class="row mt-3">
            <div class="col-md-6 mb-2">
              <button class="btn btn-success w-100 btn-action" onclick="bookRide()">
                <i class="fas fa-credit-card me-1"></i> Book Now
              </button>
            </div>
            <div class="col-md-6 mb-2">
              <button class="btn btn-outline-light w-100 btn-action" onclick="scheduleRide()">
                <i class="fas fa-calendar-plus me-1"></i> Schedule Later
              </button>
            </div>
            <div class="col-md-6 mb-2">
              <button class="btn btn-outline-light w-100 btn-action" onclick="shareRide()">
                <i class="fas fa-share me-1"></i> Share with Friends
              </button>
            </div>
            <div class="col-md-6 mb-2">
              <button class="btn btn-outline-light w-100 btn-action" onclick="saveTrip()">
                <i class="fas fa-bookmark me-1"></i> Save Trip
              </button>
            </div>
          </div>

          <div class="mt-3 p-3 bg-dark bg-opacity-25 rounded">
            <h6 class="mb-2"><i class="fas fa-info-circle"></i> Trip Summary</h6>
            <div id="tripSummary"></div>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="row mt-4" id="quickStats" style="display: none;">
        <div class="col-md-3 mb-3">
          <div class="stats-card">
            <i class="fas fa-users fa-2x text-primary mb-2"></i>
            <h6>Total Riders</h6>
            <h4 id="totalRiders">0</h4>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="stats-card">
            <i class="fas fa-route fa-2x text-success mb-2"></i>
            <h6>Distance</h6>
            <h4 id="totalDistance">0 km</h4>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="stats-card">
            <i class="fas fa-rupee-sign fa-2x text-warning mb-2"></i>
            <h6>Per Person</h6>
            <h4 id="costPerPerson">‚Çπ0</h4>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="stats-card">
            <i class="fas fa-leaf fa-2x text-info mb-2"></i>
            <h6>CO‚ÇÇ Saved</h6>
            <h4 id="co2Saved">0 kg</h4>
          </div>
        </div>
      </div>
    </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // Enhanced city coordinates and data
      // City coordinates
      const cityCoords = {
        "Indore": [22.7196, 75.8577],
        "Ujjain": [23.1793, 75.7849],
        "Bhopal": [23.2599, 77.4126],
        "Dewas": [22.9676, 76.0534],
        "Ratlam": [23.3315, 75.0367],
        "Gwalior": [26.2183, 78.1828]
      };

      // Distances between cities (in km)
      const distances = {
        "Indore-Ujjain": 55, "Ujjain-Indore": 55,
        "Ujjain-Bhopal": 190, "Bhopal-Ujjain": 190,
        "Indore-Bhopal": 245, "Bhopal-Indore": 245,
        "Indore-Dewas": 35, "Dewas-Indore": 35,
        "Dewas-Ujjain": 45, "Ujjain-Dewas": 45,
        "Dewas-Bhopal": 145, "Bhopal-Dewas": 145,
        "Indore-Ratlam": 80, "Ratlam-Indore": 80,
        "Ujjain-Ratlam": 90, "Ratlam-Ujjain": 90,
        "Ratlam-Bhopal": 280, "Bhopal-Ratlam": 280,
        "Bhopal-Gwalior": 330, "Gwalior-Bhopal": 330,
        "Indore-Gwalior": 475, "Gwalior-Indore": 475,
        "Ujjain-Gwalior": 395, "Gwalior-Ujjain": 395,
        "Dewas-Ratlam": 85, "Ratlam-Dewas": 85,
        "Dewas-Gwalior": 440, "Gwalior-Dewas": 440,
        "Ratlam-Gwalior": 365, "Gwalior-Ratlam": 365
      };

      const vehicleRates = {
        sedan: { rate: 12, seats: 4, name: "Sedan", number: "MP 09 CD 5678" },
        suv: { rate: 15, seats: 7, name: "SUV", number: "MP 12 EF 9012" },
        luxury: { rate: 20, seats: 4, name: "Luxury Car", number: "MP 15 GH 3456" }
      };

      let selectedVehicle = 'sedan';
      let selectedTime = '';
      let selectedFeatures = [];
      let currentPassengers = { pax1: 1, pax2: 1 };

      // Initialize map
      const map = L.map('map').setView([23.2599, 77.4126], 6);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);
      let routeLayer;

      // Swap start & destination
      function swapLocations() {
        const start = document.getElementById('start');
        const destination = document.getElementById('destination');
        const temp = start.value;
        start.value = destination.value;
        destination.value = temp;
        showNotification('Locations swapped', 'info');
      }

      // Passenger counter
      function changePassengers(pax, delta) {
        currentPassengers[pax] += delta;
        if (currentPassengers[pax] < 1) currentPassengers[pax] = 1;
        document.getElementById(pax + 'Display').innerText = currentPassengers[pax];
        if (pax === 'pax1') document.getElementById('paxStartToIntermediate').value = currentPassengers[pax];
        if (pax === 'pax2') document.getElementById('paxIntermediateToDestination').value = currentPassengers[pax];
      }

      // Vehicle selection
      document.querySelectorAll('.vehicle-card').forEach(card => {
        card.addEventListener('click', () => {
          document.querySelectorAll('.vehicle-card').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          selectedVehicle = card.dataset.vehicle;
          document.getElementById('selectedVehicleInfo').innerText = vehicleRates[selectedVehicle].name + " - " + vehicleRates[selectedVehicle].number;
        });
      });

      // Feature selection
      document.querySelectorAll('.feature-badge').forEach(badge => {
        badge.addEventListener('click', () => {
          badge.classList.toggle('active');
          const feature = badge.dataset.feature;
          if (selectedFeatures.includes(feature)) {
            selectedFeatures = selectedFeatures.filter(f => f !== feature);
          } else selectedFeatures.push(feature);
        });
      });

      // Time slot selection
      document.querySelectorAll('.time-slot').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.time-slot').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          selectedTime = btn.dataset.time;
        });
      });

      // Notification
      function showNotification(msg, type = 'info') {
        const container = document.getElementById('notificationContainer');
        const notif = document.createElement('div');
        notif.className = `notification ${type} show`;
        notif.innerText = msg;
        container.appendChild(notif);
        setTimeout(() => notif.remove(), 3000);
      }

      // Form submit
      function getLegDistance(from, to) {
        return distances[`${from}-${to}`] || 0;
      }

      document.getElementById('cabForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const start = document.getElementById('start').value;
        const dest = document.getElementById('destination').value;
        const interOptions = Array.from(document.getElementById('intermediate').selectedOptions);
        const intermediates = interOptions.map(opt => opt.value).filter(v => v && v !== start && v !== dest);

        if (!start || !dest || !selectedTime) {
          showNotification('Please select start, destination, and time!', 'error');
          return;
        }

        const route = [start, ...intermediates, dest];

        // Build legs
        const legs = [];
        for (let i = 0; i < route.length - 1; i++) {
          const from = route[i];
          const to = route[i + 1];
          const distance = getLegDistance(from, to);
          legs.push({ from, to, distance });
        }

        // Define passengers per leg
        const legPassengers = [];
        if (legs.length === 1) {
          legPassengers.push(currentPassengers.pax1);
        } else {
          legPassengers.push(currentPassengers.pax1); // start ‚Üí first intermediate
          for (let i = 1; i < legs.length; i++) {
            legPassengers.push(currentPassengers.pax2); // intermediate ‚Üí next
          }
        }

        // Fare calculation per leg
        const legFares = legs.map((leg, idx) => leg.distance * vehicleRates[selectedVehicle].rate);
        const farePerLegHTML = legFares.map((fare, idx) => {
          const perPerson = fare / legPassengers[idx];
          return `<p>${legs[idx].from} ‚Üí ${legs[idx].to}: ‚Çπ${fare} (‚Çπ${perPerson.toFixed(2)}/passenger)</p>`;
        }).join('');

        // Features cost
        let featuresCost = 0;
        selectedFeatures.forEach(f => {
          const badge = document.querySelector(`.feature-badge[data-feature="${f}"]`);
          featuresCost += Number(badge.dataset.cost);
        });

        // Total fare
        const totalFare = legFares.reduce((a, b) => a + b, 0) + featuresCost;

        // Total distance
        const totalDistance = legs.reduce((a, b) => a + b.distance, 0);

        // Display fare
        document.getElementById('fareCard').style.display = 'block';
        document.getElementById('fareResult').innerHTML = `
    <p>Total Distance: <strong>${totalDistance} km</strong></p>
    <p>Vehicle: <strong>${vehicleRates[selectedVehicle].name}</strong></p>
    <p>Features: ‚Çπ${featuresCost}</p>
    ${farePerLegHTML}
    <p><strong>Total Fare: ‚Çπ${totalFare}</strong></p>
  `;

        // ETA (50 km/h)
        const etaHours = totalDistance / 50;
        const etaMins = Math.round((etaHours - Math.floor(etaHours)) * 60);
        document.getElementById('etaInfo').style.display = 'block';
        document.getElementById('etaContent').innerHTML = `<p>Estimated Duration: ${Math.floor(etaHours)}h ${etaMins}min</p>`;

        // CO2 saved
        const co2Saved = legPassengers.reduce((sum, pax, i) => sum + (pax - 1) * legs[i].distance * 0.12, 0);
        document.getElementById('carbonInfo').style.display = 'block';
        document.getElementById('carbonContent').innerHTML = `<p>Estimated CO‚ÇÇ Saved: ${co2Saved.toFixed(2)} kg</p>`;

        // Update map route
        if (routeLayer) map.removeLayer(routeLayer);
        const routeCoords = route.map(city => cityCoords[city]);
        routeLayer = L.polyline(routeCoords, { color: 'blue', weight: 5 }).addTo(map);
        map.fitBounds(routeLayer.getBounds());

        // Trip summary
        document.getElementById('tripSummary').innerHTML = `<p>${route.join(' ‚Üí ')}</p><p>Time: ${selectedTime}</p>`;
      });

      // Dummy driver contact
      function contactDriver(method) {
        showNotification(`Driver contact via ${method.toUpperCase()} initiated`, 'info');
      }
      function bookRide() { showNotification('Ride booked successfully!', 'success'); }
      function scheduleRide() { showNotification('Ride scheduled successfully!', 'success'); }
      function shareRide() { showNotification('Trip link copied to clipboard!', 'info'); }
      function saveTrip() { showNotification('Trip saved successfully!', 'success'); }

      // Weather Widget (Dummy data for Bhopal)
      const weatherInfo = document.getElementById('weatherInfo');
      setTimeout(() => {
        weatherInfo.innerHTML = `
      <p>‚òÄÔ∏è 30¬∞C, Clear Sky</p>
      <p>Humidity: 45% | Wind: 10 km/h</p>
    `;
      }, 1500);
    </script>
</body>

</html>